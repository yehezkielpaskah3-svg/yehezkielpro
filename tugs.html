<!doctype html>
<html lang="id">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Manajemen Data Mahasiswa — Single File</title>
    <style>
        :root {
            /* Warna Disesuaikan untuk Tema Gelap Hijau */
            --bg: #0d1a15;
            /* Latar belakang gelap */
            --card: rgba(0, 0, 0, 0.75);
            /* Kartu transparan gelap */
            --muted: #808080;
            /* Teks sekunder gelap */
            --primary: #4CAF50;
            /* Hijau Primary */
            --danger: #ef4444;
            --text-light: #e0fff3;
            /* Teks terang untuk latar belakang gelap */
            --green-glow: #39FF14;
            /* Warna neon/glow hijau */
            --input-bg: #000000;
            --border-dark: #1e3a8a;
            --table-header-bg: rgba(57, 255, 20, 0.1);
        }

        * {
            box-sizing: border-box
        }

        body {
            font-family: Inter, system-ui, Roboto, Arial;
            margin: 0;
            min-height: 100vh;
            /* Latar Belakang Gambar Kosmik */
            background: var(--bg) url('https://images.unsplash.com/photo-1543169733-469b6b8d4e9c?fit=crop&w=1500&q=80');
            background-size: cover;
            background-position: center;
            color: var(--text-light);
        }

        .center {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 28px;
            /* Menghapus min-height 100vh agar aplikasi tidak terpotong */
        }

        .window {
            width: 100%;
            max-width: 1100px
        }

        .card {
            /* Tema gelap konsisten untuk semua card */
            background: var(--card);
            border-radius: 12px;
            padding: 16px;
            box-shadow: 0 0 10px rgba(57, 255, 20, 0.2);
            /* Efek glow ringan */
            border: 1px solid rgba(57, 255, 20, 0.3);
        }

        /* -------------------------
           LAYOUT LOGIN (Fokus)
           ------------------------- */
        .login-wrap {
            max-width: 400px;
            margin: 28px auto;
            display: block;
        }

        .login-title {
            text-align: center;
            font-size: 2.5em;
            margin-bottom: 25px;
            font-weight: bold;
            letter-spacing: 2px;
            color: var(--green-glow);
            text-shadow: 0 0 10px var(--green-glow), 0 0 20px var(--green-glow);
        }

        .forgot-signup {
            display: flex;
            justify-content: space-between;
            margin-top: 5px;
            margin-bottom: 20px;
            font-size: 14px;
        }

        .forgot-signup a {
            color: var(--green-glow);
            text-decoration: none;
            text-shadow: 0 0 3px rgba(57, 255, 20, 0.5);
        }

        .login-right {
            display: none;
            /* Sembunyikan cover lama */
        }

        /* -------------------------
           GENERAL ELEMENTS
           ------------------------- */

        h1,
        h2,
        h3,
        h4 {
            margin: 0 0 10px 0;
            color: var(--green-glow);
            text-shadow: 0 0 3px rgba(57, 255, 20, 0.5);
        }

        .muted {
            color: var(--muted);
            font-size: 13px
        }

        input[type=text],
        input[type=password],
        select {
            width: 100%;
            padding: 10px;
            margin-top: 8px;
            border-radius: 6px;
            border: 1px solid var(--border-dark);
            font-size: 14px;
            background: var(--input-bg);
            color: var(--text-light);
        }

        button {
            padding: 10px 12px;
            border-radius: 8px;
            border: none;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s;
        }

        .btn-primary {
            background: var(--green-glow);
            color: #000;
        }

        .btn-primary:hover {
            opacity: 0.8;
        }

        .btn-ghost {
            background: transparent;
            border: 1px solid var(--green-glow);
            color: var(--green-glow);
        }

        .btn-ghost:hover {
            background: rgba(57, 255, 20, 0.1);
        }

        .btn-danger {
            background: var(--danger);
            color: white
        }

        .layout {
            display: grid;
            grid-template-columns: 360px 1fr;
            gap: 18px
        }

        /* -------------------------
           APP SPECIFIC ELEMENTS
           ------------------------- */

        .topbar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px
        }

        .logo {
            width: 48px;
            height: 48px;
            border-radius: 10px;
            background: var(--green-glow);
            display: flex;
            align-items: center;
            justify-content: center;
            color: #000;
            /* Warna hitam di logo */
            font-weight: 700;
            box-shadow: 0 0 5px var(--green-glow);
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 8px;
            font-size: 14px
        }

        th,
        td {
            padding: 10px;
            border-bottom: 1px solid #1e3a8a;
            /* Garis pemisah gelap */
            text-align: left;
        }

        th {
            background: var(--table-header-bg);
            font-weight: 600;
            color: var(--green-glow);
        }

        td button {
            padding: 6px 10px;
            font-size: 12px;
        }

        .delBtn {
            background: #440000;
            border: 1px solid var(--danger);
            color: var(--danger);
        }

        .log {
            background: #000000;
            padding: 10px;
            border-radius: 8px;
            max-height: 140px;
            overflow: auto;
            font-size: 13px;
            color: var(--text-light);
            border: 1px solid #1e3a8a;
        }

        .highlight {
            background: rgba(57, 255, 20, 0.2);
            color: var(--green-glow);
        }

        hr {
            margin: 12px 0;
            border: none;
            border-top: 1px solid rgba(57, 255, 20, 0.2);
        }

        @media(max-width:980px) {
            .layout {
                grid-template-columns: 1fr
            }

            .login-wrap {
                flex-direction: column
            }

            .login-right {
                height: 220px
            }
        }

        a {
            color: var(--green-glow);
            text-decoration: none;
        }

        a:hover {
            text-decoration: underline;
        }
    </style>
</head>

<body>

    <div class="center">
        <div class="window">

            <div id="loginWrap" class="login-wrap card">
                <div class="login-title">SIGN IN</div>

                <div aria-live="polite">
                    <label style="margin-top:0">Username</label>
                    <input id="loginName" type="text" placeholder="" autocomplete="username">

                    <label>Password</label>
                    <input id="loginPass" type="password" placeholder="" autocomplete="current-password">

                    <div class="forgot-signup">
                        <a href="#" class="forgot-link">Forgot Password</a>
                        <a href="#" class="signup-link">signup</a>
                    </div>

                    <div style="margin-top:10px">
                        <button class="btn-primary" style="width:100%" onclick="doLogin()">LOGIN</button>
                    </div>

                    <div id="loginError" class="small" style="color:#b91c1c;margin-top:10px; text-align:center"></div>
                    <div class="small" style="margin-top:10px; text-align:center">
                        <span class="muted">Default: <strong>yehezkiel</strong> / <strong>150406</strong></span>
                        <br>
                        <button class="btn-ghost" onclick="fillDemo()"
                            style="margin-top:5px; padding:6px 12px; font-size:12px">Isi contoh</button>
                    </div>
                </div>
            </div>

            <div id="app" class="card" style="display:none; margin-top:18px">
                <div class="topbar">
                    <div style="display:flex;align-items:center;gap:12px">
                        <div class="logo">MD</div>
                        <div>
                            <h1>Manajemen Data Mahasiswa</h1>
                            <div class="muted">CRUD • Sort • Search • File I/O • OOP • Validasi</div>
                        </div>
                    </div>
                    <div style="display:flex;align-items:center;gap:12px">
                        <div class="small muted">User: <strong id="userBadge"></strong></div>
                        <button class="btn-ghost" onclick="doLogout()">Logout</button>
                    </div>
                </div>

                <div class="layout">
                    <div>
                        <div class="card">
                            <h3>Tambah / Edit Mahasiswa</h3>
                            <form id="studentForm" onsubmit="return false">
                                <input type="hidden" id="editIndex">
                                <label>Nama</label>
                                <input id="nameInput" type="text" placeholder="Nama lengkap">
                                <label>NIM</label>
                                <input id="nimInput" type="text" placeholder="241011402104">

                                <div class="small muted" style="margin-top:6px">Regex: Nama (huruf/angka/spasi . _ - '),
                                    NIM 9–12 digit</div>

                                <div style="display:flex;gap:8px;margin-top:12px">
                                    <button id="addBtn" class="btn-primary">Tambah</button>
                                    <button id="saveBtn" class="btn-primary" style="display:none">Simpan</button>
                                    <button id="cancelBtn" class="btn-ghost" style="display:none">Batal</button>
                                </div>
                            </form>

                            <hr>

                            <h4>Sort & Search</h4>
                            <label>Urutkan berdasarkan</label>
                            <select id="sortField">
                                <option value="nim">NIM</option>
                                <option value="name">Nama</option>
                            </select>

                            <label style="margin-top:8px">Algoritma pengurutan</label>
                            <select id="sortAlgo">
                                <option value="insertion">Insertion</option>
                                <option value="merge">Merge</option>
                                <option value="bubble">Bubble</option>
                                <option value="selection">Selection</option>
                            </select>
                            <div style="display:flex;align-items:center;gap:8px;margin-top:8px">
                                <button id="sortBtn" class="btn-primary">Urutkan</button>
                                <div id="sortComplexity" class="small muted"></div>
                            </div>

                            <label style="margin-top:10px">Cari (NIM / Nama)</label>
                            <input id="searchInput" type="text" placeholder="Masukkan keyword...">
                            <label style="margin-top:6px">Algoritma pencarian</label>
                            <select id="searchAlgo">
                                <option value="linear">Linear</option>
                                <option value="binary">Binary (butuh sorted by NIM)</option>
                                <option value="sequential">Sequential (alias Linear)</option>
                            </select>
                            <div style="display:flex;gap:8px;margin-top:8px">
                                <button id="searchBtn" class="btn-primary">Cari</button>
                                <button id="clearSearchBtn" class="btn-ghost">Reset</button>
                            </div>

                            <hr>

                            <h4>File I/O</h4>
                            <div style="display:flex;gap:8px;align-items:center">
                                <button id="downloadBtn" class="btn-primary">Download JSON</button>
                                <input id="fileInput" type="file" accept=".json" style="flex:1;padding:6px">
                                <button id="uploadBtn" class="btn-ghost">Upload JSON</button>
                            </div>

                            <hr>
                            <h4>Status & Log</h4>
                            <div id="status" class="muted small">Siap.</div>
                            <div id="log" class="log" aria-live="polite"></div>
                        </div>
                    </div>

                    <div>
                        <div class="card">
                            <div style="display:flex;justify-content:space-between;align-items:center">
                                <h3>Daftar Mahasiswa <span class="small muted" id="countInfo"></span></h3>
                                <div style="display:flex;gap:8px">
                                    <button id="loadSampleBtn" class="btn-ghost">Load Sample</button>
                                    <button id="clearAllBtn" class="btn-danger">Hapus Semua</button>
                                </div>
                            </div>

                            <table id="studentsTable" aria-describedby="countInfo">
                                <thead>
                                    <tr>
                                        <th>No.</th>
                                        <th>Nama</th>
                                        <th>NIM</th>
                                        <th>Aksi</th>
                                    </tr>
                                </thead>
                                <tbody></tbody>
                            </table>

                            <hr>
                            <h4>Estimasi Time Complexity</h4>
                            <ul class="small muted">
                                <li>Insertion Sort: $O(n^2)$ (worst), $O(n)$ (best)</li>
                                <li>Merge Sort: $O(n \log n)$</li>
                                <li>Bubble Sort: $O(n^2)$</li>
                                <li>Selection Sort: $O(n^2)$</li>
                                <li>Linear/Sequential Search: $O(n)$</li>
                                <li>Binary Search: $O(\log n)$</li>
                            </ul>

                            <div class="small muted" style="margin-top:10px">
                                Guidelines: camelCase variables, PascalCase classes, modular functions, comments. Errors
                                handled with AppException.
                            </div>
                        </div>
                    </div>
                </div>
            </div>

        </div>
    </div>

    <script>
        /* ===========================
           Single-file app JS
           - Semua kode JavaScript asli dipertahankan + penyelesaian
           =========================== */

        /* -------------------------
           Custom exception
           ------------------------- */
        class AppException extends Error { constructor(m) { super(m); this.name = 'AppException'; } }

        /* -------------------------
           OOP classes
           ------------------------- */
        class Person {
            constructor(name) { this.setName(name); }
            setName(name) {
                if (typeof name !== 'string' || !name.trim()) throw new AppException('Nama tidak boleh kosong.');
                const nameRegex = /^[\p{L}\d ._'\-]+$/u;
                if (!nameRegex.test(name.trim())) throw new AppException('Nama mengandung karakter tidak valid.');
                this._name = name.trim();
            }
            getName() { return this._name; }
        }

        class Student extends Person {
            constructor(name, nim) { super(name); this.setNim(nim); }
            setNim(nim) {
                if (typeof nim !== 'string') nim = String(nim);
                const nimRegex = /^\d{9,12}$/;
                if (!nimRegex.test(nim.trim())) throw new AppException('NIM harus 9–12 digit angka.');
                this._nim = nim.trim();
            }
            getNim() { return this._nim; }
            toJSON() { return { name: this._name, nim: this._nim }; }
            toString() { return `${this._name} (${this._nim})`; }
        }

        /* -------------------------
           StudentManager (array-based)
           ------------------------- */
        class StudentManager {
            constructor() { this.students = []; this.logMsgs = []; this.isSortedByNim = false; }
            log(m) { this.logMsgs.unshift(`[${new Date().toLocaleTimeString()}] ${m}`); updateLogUI(); }
            addStudent(name, nim) {
                const s = new Student(name, nim);
                if (this.students.some(st => st.getNim() === s.getNim())) throw new AppException('NIM sudah ada.');
                this.students.push(s); this.isSortedByNim = false; this.log('Tambah: ' + s.toString());
                saveToLocal(); updateTableUI();
            }
            editStudent(index, newName, newNim) {
                if (!Number.isInteger(index) || index < 0 || index >= this.students.length) throw new AppException('Index edit tidak valid.');
                const other = this.students.filter((_, i) => i !== index);
                if (other.some(st => st.getNim() === String(newNim).trim())) throw new AppException('NIM sudah dipakai.');
                const tmp = new Student(newName, newNim);
                this.students[index].setName(tmp.getName());
                this.students[index].setNim(tmp.getNim());
                this.isSortedByNim = false; this.log('Edit index ' + index + ': ' + tmp.toString());
                saveToLocal(); updateTableUI();
            }
            deleteStudent(index) {
                if (!Number.isInteger(index) || index < 0 || index >= this.students.length) throw new AppException('Index hapus tidak valid.');
                const rem = this.students.splice(index, 1)[0]; this.isSortedByNim = false; this.log('Hapus: ' + rem.toString());
                saveToLocal(); updateTableUI();
            }
            clearAll() { this.students = []; this.isSortedByNim = false; this.log('Semua data dihapus.'); saveToLocal(); updateTableUI(); }
            getAll() { return this.students.slice(); }
            comparatorFactory(field) { if (field === 'nim') return (a, b) => Number(a.getNim()) - Number(b.getNim()); return (a, b) => a.getName().localeCompare(b.getName(), undefined, { sensitivity: 'base' }); }

            insertionSort(field = 'nim') { const comp = this.comparatorFactory(field); const arr = this.students; for (let i = 1; i < arr.length; i++) { let j = i - 1; const key = arr[i]; while (j >= 0 && comp(arr[j], key) > 0) { arr[j + 1] = arr[j]; j--; } arr[j + 1] = key; } this.isSortedByNim = (field === 'nim'); this.log('Diurutkan (Insertion) by ' + field); saveToLocal(); updateTableUI(); }

            mergeSort(field = 'nim') {
                const comp = this.comparatorFactory(field);
                const merge = (L, R) => {
                    const out = []; let i = 0, j = 0;
                    while (i < L.length && j < R.length) {
                        if (comp(L[i], R[j]) <= 0) out.push(L[i++]);
                        else out.push(R[j++]);
                    }
                    while (i < L.length) out.push(L[i++]);
                    while (j < R.length) out.push(R[j++]);
                    return out;
                };
                const ms = (arr) => {
                    if (arr.length <= 1) return arr;
                    const mid = Math.floor(arr.length / 2);
                    return merge(ms(arr.slice(0, mid)), ms(arr.slice(mid)));
                };
                this.students = ms(this.students);
                this.isSortedByNim = (field === 'nim');
                this.log('Diurutkan (Merge) by ' + field);
                saveToLocal(); updateTableUI();
            }

            bubbleSort(field = 'nim') { const comp = this.comparatorFactory(field); const arr = this.students; for (let i = 0; i < arr.length - 1; i++) for (let j = 0; j < arr.length - 1 - i; j++) if (comp(arr[j], arr[j + 1]) > 0) [arr[j], arr[j + 1]] = [arr[j + 1], arr[j]]; this.isSortedByNim = (field === 'nim'); this.log('Diurutkan (Bubble) by ' + field); saveToLocal(); updateTableUI(); }

            selectionSort(field = 'nim') { const comp = this.comparatorFactory(field); const arr = this.students; for (let i = 0; i < arr.length - 1; i++) { let minIdx = i; for (let j = i + 1; j < arr.length; j++) if (comp(arr[j], arr[minIdx]) < 0) minIdx = j; if (minIdx !== i) [arr[i], arr[minIdx]] = [arr[minIdx], arr[i]]; } this.isSortedByNim = (field === 'nim'); this.log('Diurutkan (Selection) by ' + field); saveToLocal(); updateTableUI(); }

            linearSearch(query) { const q = String(query).trim().toLowerCase(); if (!q) return []; const res = []; this.students.forEach((st, idx) => { if (st.getNim().toLowerCase().includes(q) || st.getName().toLowerCase().includes(q)) res.push(idx); }); this.log('Linear search "' + query + '" => ' + res.length + ' found'); return res; }

            binarySearchByNim(targetNim) { if (!this.isSortedByNim) throw new AppException('Binary search butuh data terurut by NIM.'); let left = 0, right = this.students.length - 1; const t = String(targetNim).trim(); while (left <= right) { const mid = Math.floor((left + right) / 2); const midNim = this.students[mid].getNim(); if (midNim === t) { this.log('Binary found ' + t + ' at ' + mid); return mid; } else if (Number(midNim) < Number(t)) left = mid + 1; else right = mid - 1; } this.log('Binary not found ' + t); return -1; }

            exportJSON() { return JSON.stringify(this.students.map(s => s.toJSON()), null, 2); }

            importJSON(jsonStr) {
                try {
                    const arr = JSON.parse(jsonStr);
                    if (!Array.isArray(arr)) throw new AppException('Format JSON harus array.');
                    const newStudents = arr.map(it => new Student(it.name || it.nama, String(it.nim || it.nim)));
                    const nims = newStudents.map(s => s.getNim()); const dup = nims.find((v, i) => nims.indexOf(v) !== i);
                    if (dup) throw new AppException('Terdapat duplikasi NIM di file: ' + dup);
                    this.students = newStudents; this.isSortedByNim = false; this.log('Import JSON berhasil. ' + this.students.length + ' mahasiswa dimuat.'); saveToLocal(); updateTableUI();
                } catch (e) {
                    if (e instanceof SyntaxError) throw new AppException('JSON parse error.');
                    throw e;
                }
            }

            loadSampleData(sampleArray) {
                this.students = sampleArray.map(it => new Student(it.name, String(it.nim)));
                this.isSortedByNim = false; this.log('Sample data dimuat.'); saveToLocal(); updateTableUI();
            }
        }

        /* -------------------------
           Data & manager init
           ------------------------- */
        const manager = new StudentManager();

        const SAMPLE_DATA = [
            { name: 'afdal laia', nim: '241011402051' },
            { name: 'dimas', nim: '241011400248' },
            { name: 'Yehezkiel', nim: '241011402104' },
            { name: 'Rozi', nim: '241011400231' },
            { name: 'M Ichsan Fachrulrozi', nim: '241011400235' },
            { name: 'Bayu Abiakso', nim: '241011400277' },
            { name: 'firman gani', nim: '241011400233' },
            { name: 'Jiwa', nim: '241011401525' },
            { name: 'Medina', nim: '241011401536' },
            { name: 'Aldo', nim: '241011401526' },
            { name: 'Fadly', nim: '241011401528' },
            { name: 'Cristian yuda', nim: '241011402026' },
            { name: 'Fazri', nim: '241011402315' },
            { name: 'AFFAN DHIYA DIL AWAR.', nim: '241011400266' },
            { name: 'RidoMaulidan_', nim: '241011400232' },
            { name: 'Muzayin', nim: '241011400261' },
            { name: 'Sulthan Arya Satwika', nim: '241011401769' },
            { name: 'Maikel', nim: '241011400276' },
            { name: 'Fariz', nim: '241011400268' },
            { name: 'Timothy', nim: '241011401936' },
            { name: 'Rian', nim: '241011400228' },
            { name: 'Syahrul', nim: '241011400253' },
            { name: 'Faya', nim: '241011403270' },
            { name: 'Lina', nim: '241011402755' },
            { name: 'Ulya', nim: '241011401655' },
            { name: 'Nia', nim: '241011400254' },
            { name: 'Elis', nim: '241011402113' },
            { name: 'Gilang', nim: '241011400269' },
            { name: 'dika', nim: '221011401131' },
            { name: 'zidan', nim: '241011400901' }
        ];

        /* -------------------------
           UI refs & helpers
           ------------------------- */
        const tbody = document.querySelector('#studentsTable tbody');
        const countInfo = document.getElementById('countInfo');
        const statusEl = document.getElementById('status');
        const logEl = document.getElementById('log');

        function escapeHtml(s) { return String(s).replace(/[&<>"']/g, m => ({ '&': '&amp;', '<': '&lt;', '>': '&gt;', '"': '&quot;', "'": '&#039;' }[m])); }
        function setStatus(t) { statusEl.textContent = t; }
        function updateLogUI() { logEl.innerHTML = manager.logMsgs.slice(0, 200).map(s => `<div>${escapeHtml(s)}</div>`).join(''); }

        /* -------------------------
           localStorage persistence
           ------------------------- */
        const STORAGE_KEY = 'md_students_v1';
        function saveToLocal() { try { localStorage.setItem(STORAGE_KEY, manager.exportJSON()); } catch (e) { console.warn('save failed', e); } }
        function loadFromLocal() { const j = localStorage.getItem(STORAGE_KEY); if (j) { try { manager.importJSON(j); return true; } catch (e) { console.warn('load failed', e); } } return false; }

        /* -------------------------
           render table
           ------------------------- */
        let currentSearchResults = [];

        function updateTableUI(highlightIndices = currentSearchResults) {
            const rows = manager.getAll();
            tbody.innerHTML = '';
            rows.forEach((st, idx) => {
                const tr = document.createElement('tr');
                tr.innerHTML = `<td>${idx + 1}</td><td>${escapeHtml(st.getName())}</td><td>${escapeHtml(st.getNim())}</td>
    <td>
      <button data-idx="${idx}" class="editBtn btn-ghost">Edit</button>
      <button data-idx="${idx}" class="delBtn">Hapus</button>
    </td>`;
                // Highlighting hanya jika indeks saat ini ada dalam hasil pencarian
                if (highlightIndices.includes(idx)) tr.classList.add('highlight');
                tbody.appendChild(tr);
            });
            countInfo.textContent = `(${rows.length} mahasiswa)`;
            setStatus('Tabel diperbarui.');
        }

        /* -------------------------
           UI events (CRUD)
           ------------------------- */
        document.getElementById('addBtn').addEventListener('click', () => {
            const name = document.getElementById('nameInput').value;
            const nim = document.getElementById('nimInput').value;
            try { manager.addStudent(name, nim); document.getElementById('nameInput').value = ''; document.getElementById('nimInput').value = ''; setStatus('Mahasiswa ditambahkan.'); } catch (e) { setStatus(e.message); manager.logMsgs.unshift('[ERR] ' + e.message); updateLogUI(); alert(e.message); }
        });

        tbody.addEventListener('click', (ev) => {
            const btn = ev.target.closest('button'); if (!btn) return;
            const idx = Number(btn.dataset.idx);
            if (btn.classList.contains('editBtn')) {
                const st = manager.getAll()[idx];
                document.getElementById('nameInput').value = st.getName();
                document.getElementById('nimInput').value = st.getNim();
                document.getElementById('editIndex').value = idx;
                document.getElementById('addBtn').style.display = 'none';
                document.getElementById('saveBtn').style.display = 'inline-block';
                document.getElementById('cancelBtn').style.display = 'inline-block';
                setStatus('Edit mode');
            } else if (btn.classList.contains('delBtn')) {
                if (!confirm('Yakin hapus?')) return;
                try { manager.deleteStudent(idx); setStatus('Data dihapus.'); } catch (e) { setStatus(e.message); manager.logMsgs.unshift('[ERR] ' + e.message); updateLogUI(); alert(e.message); }
            }
        });

        document.getElementById('saveBtn').addEventListener('click', () => {
            const idx = Number(document.getElementById('editIndex').value);
            const name = document.getElementById('nameInput').value;
            const nim = document.getElementById('nimInput').value;
            try { manager.editStudent(idx, name, nim); document.getElementById('editIndex').value = ''; document.getElementById('nameInput').value = ''; document.getElementById('nimInput').value = ''; document.getElementById('addBtn').style.display = 'inline-block'; document.getElementById('saveBtn').style.display = 'none'; document.getElementById('cancelBtn').style.display = 'none'; setStatus('Perubahan tersimpan.'); } catch (e) { setStatus(e.message); manager.logMsgs.unshift('[ERR] ' + e.message); updateLogUI(); alert(e.message); }
        });

        document.getElementById('cancelBtn').addEventListener('click', () => {
            document.getElementById('editIndex').value = ''; document.getElementById('nameInput').value = ''; document.getElementById('nimInput').value = ''; document.getElementById('addBtn').style.display = 'inline-block'; document.getElementById('saveBtn').style.display = 'none'; document.getElementById('cancelBtn').style.display = 'none'; setStatus('Edit dibatalkan.');
        });

        /* -------------------------
           Sort handlers
           ------------------------- */
        const complexityMap = { insertion: 'Insertion — Worst $O(n^2)$ Best $O(n)$', merge: 'Merge — $O(n \log n)$', bubble: 'Bubble — $O(n^2)$', selection: 'Selection — $O(n^2)$' };
        document.getElementById('sortAlgo').addEventListener('change', (e) => document.getElementById('sortComplexity').textContent = complexityMap[e.target.value] || '');
        document.getElementById('sortComplexity').textContent = complexityMap[document.getElementById('sortAlgo').value];

        document.getElementById('sortBtn').addEventListener('click', () => {
            const f = document.getElementById('sortField').value;
            const a = document.getElementById('sortAlgo').value;
            try {
                if (a === 'insertion') manager.insertionSort(f);
                else if (a === 'merge') manager.mergeSort(f);
                else if (a === 'bubble') manager.bubbleSort(f);
                else if (a === 'selection') manager.selectionSort(f);
                setStatus('Diurutkan (' + a + ' by ' + f + ')');
                currentSearchResults = []; // Clear search results after sorting
            } catch (e) { setStatus(e.message); manager.logMsgs.unshift('[ERR] ' + e.message); updateLogUI(); alert(e.message); }
        });

        /* -------------------------
           Search handlers
           ------------------------- */
        document.getElementById('searchBtn').addEventListener('click', () => {
            const q = document.getElementById('searchInput').value;
            const algo = document.getElementById('searchAlgo').value;
            let results = [];
            try {
                if (!q) {
                    currentSearchResults = [];
                    updateTableUI();
                    setStatus('Masukkan keyword untuk mencari.');
                    return;
                }

                if (algo === 'binary') {
                    if (!manager.isSortedByNim) throw new AppException('Binary search gagal: Data harus diurutkan berdasarkan NIM terlebih dahulu.');
                    // Binary search hanya mencari satu NIM spesifik. Jika target bukan NIM, fallback ke linear.
                    const idx = manager.binarySearchByNim(q);
                    if (idx !== -1) results = [idx];
                } else {
                    // Linear search (alias Sequential) mencari di Nama dan NIM
                    results = manager.linearSearch(q);
                }

                currentSearchResults = results;
                updateTableUI(currentSearchResults);
                setStatus(`Pencarian ${algo} untuk "${q}" selesai. Ditemukan: ${results.length}.`);

            } catch (e) {
                setStatus(e.message);
                manager.logMsgs.unshift('[ERR] ' + e.message);
                updateLogUI();
                alert(e.message);
            }
        });

        document.getElementById('clearSearchBtn').addEventListener('click', () => {
            document.getElementById('searchInput').value = '';
            currentSearchResults = [];
            updateTableUI();
            setStatus('Pencarian direset.');
        });

        /* -------------------------
           File I/O handlers
           ------------------------- */
        document.getElementById('downloadBtn').addEventListener('click', () => {
            const json = manager.exportJSON();
            const blob = new Blob([json], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'data_mahasiswa.json';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            setStatus('Data berhasil didownload.');
            manager.log('Data didownload sebagai JSON.');
        });

        document.getElementById('uploadBtn').addEventListener('click', () => {
            const fileInput = document.getElementById('fileInput');
            const file = fileInput.files[0];
            if (!file) {
                alert('Pilih file JSON terlebih dahulu.');
                return;
            }
            if (!confirm('Data yang ada saat ini akan ditimpa. Lanjutkan?')) return;

            const reader = new FileReader();
            reader.onload = (e) => {
                try {
                    manager.importJSON(e.target.result);
                    setStatus('Data berhasil di-upload dan dimuat.');
                } catch (err) {
                    setStatus(err.message);
                    manager.logMsgs.unshift('[ERR] ' + err.message);
                    updateLogUI();
                    alert(err.message);
                }
            };
            reader.onerror = () => {
                setStatus('Gagal membaca file.');
                manager.logMsgs.unshift('[ERR] Gagal membaca file.');
                updateLogUI();
            };
            reader.readAsText(file);
        });

        /* -------------------------
           General actions
           ------------------------- */
        document.getElementById('loadSampleBtn').addEventListener('click', () => {
            if (manager.students.length > 0 && !confirm('Ini akan menghapus data yang ada. Muat data sampel?')) return;
            try { manager.loadSampleData(SAMPLE_DATA); setStatus('Data sampel dimuat.'); } catch (e) { setStatus(e.message); manager.logMsgs.unshift('[ERR] ' + e.message); updateLogUI(); alert(e.message); }
        });

        document.getElementById('clearAllBtn').addEventListener('click', () => {
            if (!confirm('Yakin ingin menghapus SEMUA data mahasiswa?')) return;
            manager.clearAll();
            setStatus('Semua data dihapus.');
        });


        /* -------------------------
           Login Logic (Simple/Demo)
           ------------------------- */

        const userPass = { 'yehezkiel': '150406' };
        let loggedInUser = null;

        function doLogin() {
            const name = document.getElementById('loginName').value;
            const pass = document.getElementById('loginPass').value;
            const errorEl = document.getElementById('loginError');

            errorEl.textContent = '';

            if (userPass[name] === pass) {
                loggedInUser = name;
                document.getElementById('loginWrap').style.display = 'none';
                document.getElementById('app').style.display = 'block';
                document.getElementById('userBadge').textContent = loggedInUser;
                manager.log('Login berhasil sebagai ' + loggedInUser);

                // Initialize table/data after successful login
                if (!loadFromLocal()) {
                    manager.log('Tidak ada data tersimpan di browser. Memuat data sampel.');
                    manager.loadSampleData(SAMPLE_DATA);
                }
                updateTableUI();
            } else {
                errorEl.textContent = 'Username atau password salah.';
            }
        }

        function doLogout() {
            loggedInUser = null;
            document.getElementById('loginWrap').style.display = 'block';
            document.getElementById('app').style.display = 'none';
            document.getElementById('loginName').value = '';
            document.getElementById('loginPass').value = '';
            manager.log('Logout.');
        }

        function fillDemo() {
            document.getElementById('loginName').value = 'yehezkiel';
            document.getElementById('loginPass').value = '150406';
        }

        /* -------------------------
           Initial Load
           ------------------------- */
        // Coba load dari LocalStorage saat pertama kali load, jika sudah login sebelumnya (demo)
        // Note: Ini hanya untuk demo. Dalam aplikasi nyata, Anda akan memeriksa status sesi server.
        const isAlreadyLoggedIn = false; // Karena ini demo, asumsikan belum login saat load halaman
        if (isAlreadyLoggedIn) {
            document.getElementById('loginWrap').style.display = 'none';
            document.getElementById('app').style.display = 'block';
            document.getElementById('userBadge').textContent = 'demo_user';
            if (!loadFromLocal()) manager.loadSampleData(SAMPLE_DATA);
            updateTableUI();
        } else {
            // Biarkan halaman login ditampilkan
        }
    </script>
</body>

</html>